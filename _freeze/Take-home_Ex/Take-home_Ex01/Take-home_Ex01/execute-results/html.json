{
  "hash": "c25c158da01936d768046b6e0064d108",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 1\"\nauthor: \"Brigitta Karen Tsai\"\ndate: \"September 7, 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  message: false\n  freeze: true\n---\n\n\n# Take-home Exercise 1: Geospatial Analytics for Public Good\n\n## 1 Overview\n\nAccording to the World Health Organization (WHO), Thailand ranks 9th out of 175 WHO registered countries for road traffic deaths. WHO estimated an average of 50 road traffic deaths. This study will explore on the causes of accidents in Bangkok Metropolitan Region, to reduce future risk of road traffic accidents in Thailand.\n\n## 2 Getting Started\n\n### 2.1 Objectives\n\nThe purpose of this study is to discover the factors affecting road traffic accidents in **Bangkok Metropolitan Region (BMR)** by employing **both spatial spatio-temporal point patterns analysis methods.**\n\nList of objectives:\n\n1.  To visualize the spatio-temporal dynamics of road traffic accidents in **BMR** using appropriate **statistical graphics and geovisualization** methods\n2.  To conduct detailed spatial analysis of road traffic accidents using appropriate **Network Spatial Point Patterns Analysis** methods.\n3.  To conduct detailed spatio-temporal analysis of road traffic accidents using appropriate **Temporal Network Spatial Point Patterns Analysis** methods.\n\nRoad Traffic Accident major factors:\n\n1.  Behavioural Factors\n    -   Driver Behaviour (driving style)\n\n    -   Driver Performance (driving skills)\n2.  Environmental Factors\n\n### 2.2 The Data\n\n#### 2.3.1 Aspatial Data\n\nThe aspatial data for this study is [**Thailand Road Accident**](https://www.kaggle.com/datasets/thaweewatboy/thailand-road-accident-2019-2022) from year 2019 to 2022 from Kaggle\n\n#### 2.3.2 Geospatial Data\n\nThe geospatial data for this study are:\n\n-   [**Thailand Roads**](https://data.humdata.org/dataset/hotosm_tha_roads) from HDX\n\n-   [**Thailand Subnational Administrative Boundaries**](https://data.humdata.org/dataset/cod-ab-tha?) from HDX\n\n### 2.3 Loading R Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sp, sf, raster, spatstat, tmap, tidyverse, spNetwork, tmaptools)\n```\n:::\n\n\n## 3 Data Preparation and Wrangling\n\n### 3.1 Importing Datasets\n\n#### 3.1.1 Import Aspatial Data into R Environment\n\nThe csv data includes Thailand Road Accident dataset from the year 2019-2022\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident_raw <- read_csv(\"data/rawdata/thai_road_accident_2019_2022.csv\") %>%\n  mutate(Month = month(incident_datetime)) %>%\n  mutate(Month_fac = month(incident_datetime, label = TRUE,\n                           abbr = TRUE)) %>%\n  mutate(dayofweek = day(incident_datetime))\n```\n:::\n\n\n#### 3.1.2 Import Geospatial Data into R Environment\n\nThe first shapefile dataset contains Thailand Roads Lines data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road_raw <- st_read(dsn = \"data/rawdata\", \n                 layer = \"hotosm_tha_roads_lines_shp\")\n```\n:::\n\n\nThe second shapefile dataset contains Thailand subnational administrative boundaries data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_boundaries_raw <- st_read(dsn = \"data/rawdata\", \n                 layer = \"tha_admbndp_admALL_rtsd_itos_20220121\")\n```\n:::\n\n\n### 3.2 Data Cleaning\n\nTo ensure smooth analysis, let us clean the datasets\n\n#### 3.2.1 Road Accident Dataset (Aspatial)\n\n**i. Remove Missing Values**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident_raw <- st_as_sf(road_accident_raw, coords = c(\"longitude\", \"latitude\"), crs = 4326)\n\nstop(\"This is an error code\")\n```\n:::\n\n\nmissing values in the longitude and latitude column is not allowed, let's remove it\n\nLet us check the missing values in both latitude and longitude column\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident_raw[is.na(road_accident_raw$latitude), ]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident_raw[is.na(road_accident_raw$longitude), ]\n```\n:::\n\n\nLet's remove the rows with missing values and derive a new cleaned dataset\n\nRemove all the records with missing value in both *latitude* and *longitude* columns using the *latitude* column\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident <- road_accident_raw[!is.na(road_accident_raw$latitude),]\n```\n:::\n\n\nLet us check if there is still existing missing value using the *longitude* column\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident[is.na(road_accident$longitude), ]\n```\n:::\n\n\n**ii. Remove Unnecessary Columns**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident$incident_time <- format(road_accident$incident_datetime, \"%H:%M:%S\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident$incident_date <- as.Date(road_accident$incident_datetime)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident <- road_accident[, !(names(road_accident) %in% c(\"province_th\", \"route\", \"report_datetime\", \"incident_datetime\"))]\n```\n:::\n\n\n**iii. Filter Values**\n\nWe are analyzing **Bangkok Metropolitan Region**, which consists of **Bangkok, Nonthaburi, Nakhon Pathom, Pathum Thani, Samut Prakan** and **Samut Sakhon.** Let's filter the values in **province_en** column\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident <- road_accident %>% \n  filter(road_accident$province_en %in% c(\"Bangkok\", \"Nonthaburi\", \"Nakhon Pathom\", \"Pathum Thani\", \"Samut Prakan\", \"Samut Sakhon\")) \n```\n:::\n\n\n**iv. Set CRS Reference System**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident <- st_as_sf(road_accident, coords = c(\"longitude\", \"latitude\"), crs = 4326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_accident <- road_accident %>% \n  st_transform(crs = 32647)\n```\n:::\n\n\n**v. Save Cleaned Dataset**\n\nLet's save the dataset to the new derived folder **rds**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(road_accident, \"data/rds/aspatial/road_accident.rds\")\n```\n:::\n\n\n#### 3.2.2 Thailand Boundaries Dataset (Geospatial)\n\n**i. Remove Unnecessary Column**\n\nLet us check whether the column includes any value\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(thai_boundaries_raw$ADM3_REF)\nunique(thai_boundaries_raw$ADM3ALT1EN)\nunique(thai_boundaries_raw$ADM3ALT2EN)\nunique(thai_boundaries_raw$ADM3ALT1TH)\nunique(thai_boundaries_raw$ADM3ALT2TH)\n```\n:::\n\n\nAll the columns consist of missing values\n\nLet us check other columns using the code below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(thai_boundaries_raw$ADM0_EN)\n```\n:::\n\n\nThis column is unnecessary as it has only 1 value, which shows that this only consist of Thailand data\n\nLet us remove all the columns listed below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_boundaries <- thai_boundaries_raw[, !(names(thai_boundaries_raw) %in% c(\"ADM3_REF\", \"ADM3ALT1EN\", \"ADM3ALT2EN\", \"ADM3ALT1TH\", \"ADM3ALT2TH\", \"ADM3_TH\",\"ADM2_TH\", \"ADM1_TH\", \"ADM0_TH\", \"ADM0_EN\", \"ADM0_PCODE\", \"ADM3_EN\", \"ADM3_PCODE\", \"ADM2_EN\", \"ADM2_PCODE\", \"validOn\", \"validTo\"))]\n```\n:::\n\n\n**ii. Filter Values**\n\nThe columns **ADM1** consist of provinces, let's check using the code chunk below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(thai_boundaries$ADM1_EN)\n```\n:::\n\n\nLet us do filtering and remove records that are not in **Bangkok Metropolitan Region**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_boundaries <- thai_boundaries %>%\n  filter(thai_boundaries$ADM1_EN %in% c(\"Bangkok\", \"Nonthaburi\", \"Nakhon Pathom\", \"Pathum Thani\", \"Samut Prakan\", \"Samut Sakhon\")) \n```\n:::\n\n\n**iii. Transform EPSG Code**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_boundaries <- thai_boundaries %>% \n  st_transform(crs = 32647)\n```\n:::\n\n\n**iv. Save Dataset**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(thai_boundaries, \"data/rds/geospatial/thai_boundaries.rds\")\n```\n:::\n\n\n#### 3.2.3 Thailand Road Dataset (Geospatial)\n\n**i. Handling Missing Values**\n\nThere are some missing values in the **road name** column, let's remove them with the code below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road <- thai_road_raw[!is.na(thai_road_raw$name_en),]\n```\n:::\n\n\n**ii. Remove Unnecessary Columns**\n\nLet us remove the columns that are not used for this analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road <- thai_road[, !(names(thai_road) %in% c(\"name\", \"name_th\", \"osm_id\", \"source\"))]\n```\n:::\n\n\n**iii. Filter Values**\n\nLet's filter the values under the **highway** column in the dataset. Urban and local road that are not wide enough for motor cars will be removed. The highway type is filtered according to this [link](https://wiki.openstreetmap.org/wiki/WikiProject_Thailand#Highway_classification)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(thai_road$highway)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road <- thai_road %>%\n  filter(thai_road$highway %in% c(\"motorway\", \"motorway_link\", \"primary\", \"primary_link\",\"secondary\",\"secondary_link\",\"tertiary\", \"tertiary_link\")) \n```\n:::\n\n\n**iv. Set CRS Referencing System**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road <- st_set_crs(thai_road, 4326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road <- thai_road %>% \n  st_transform(crs = 32647)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road <- st_cast(thai_road, \"LINESTRING\")\n```\n:::\n\n\n**v. Save Dataset**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(thai_road, \"data/rds/geospatial/thai_road.rds\")\n```\n:::\n\n\n### 3.3 Perform Intersection\n\nThe **thai_road** data includes all roads in Thailand. Our area of focus in this analysis is only in **Bangkok Metropolitan Region (BMR)**. Let's perform *st_intersection()* to filter out the roads data into only BMR area. Before we perform *st_intersection()*, let's read the cleaned file of **thai_road** data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_road_rds <- read_rds(\"data/rds/geospatial/thai_road.rds\")\n```\n:::\n\n\nCreate a convex polygon around the points in boundaries data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_polygon <- st_convex_hull(st_union(bmr_boundary))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_polygon_sf <- st_sf(geometry = bmr_polygon)\n```\n:::\n\n\nPerform the intersection of data points\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_road <- st_intersection(thai_road_rds, bmr_polygon)\n```\n:::\n\n\nSave the new **Bangkok Metropolitan Region** roads to rds file\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(bmr_road, \"data/rds/geospatial/bmr_road.rds\")\n```\n:::\n\n\n### 3.4 Cleaned Dataset\n\nAfter the steps above, the datasets are all cleaned and filtered to **Bangkok Metropolitan Region** area. Now the dataset is ready for use\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_accident <- read_rds(\"data/rds/aspatial/road_accident.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_boundary <- read_rds(\"data/rds/geospatial/thai_boundaries.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_road <- read_rds(\"data/rds/geospatial/bmr_road.rds\")\n```\n:::\n\n\n## 4 Geovisualization and Analysis\n\nAs stated on the **Objectives**, let us conduct the analysis using the cleaned dataset\n\n### 4.1 **Visualize Spatio-temporal Dynamics of Road Accidents**\n\nUsing appropriate statistical graphics and geovisualization methods, visualize the spatio-temporal dynamics of road accident in **Bangkok Metropolitan Region** area.\n\n#### 4.1.1 Convert sf to Spatial class\n\n\n::: {.cell}\n\n```{.r .cell-code}\naccidents <- as_Spatial(bmr_accident)\nroads <- as_Spatial(bmr_road)\nboundaries <- as_Spatial(bmr_boundary) \n```\n:::\n\n\n#### 4.1.2 Create an owin object class from polygon sf\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_boundary_owin <- as.owin(bmr_polygon_sf)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(bmr_boundary_owin)\n```\n:::\n\n\n#### 4.1.3 Convert to spatstat's ppp format\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_accident_ppp <- as.ppp(bmr_accident)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in as.ppp.sf(bmr_accident): only first attribute column is used for\nmarks\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nany(duplicated(bmr_accident_ppp))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(bmr_accident_ppp)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\nFrom the plot above, we can see that the thicker dots are where accidents occur more frequently.\n\n#### 4.1.4 Accident Points Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(accidents) +\n  tm_dots(alpha=0.5,\n          size=0.05) +\n  tm_basemap(server = \"OpenStreetMap\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n\n![](images/clipboard-11498863.png)\n\n### 4.2 Cause of Accident Analysis\n\nAs seen from the accident points visualization, there are a lot of accident points. Let's dive into the causes of the accidents. Before\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(bmr_accident$presumed_cause)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"speeding\"                                      \n [2] \"running red lights/traffic signals\"            \n [3] \"other\"                                         \n [4] \"driving under the influence of alcohol\"        \n [5] \"cutting in closely by people/vehicles/animals\" \n [6] \"vehicle equipment failure\"                     \n [7] \"falling asleep\"                                \n [8] \"illegal overtaking\"                            \n [9] \"tailgating\"                                    \n[10] \"failure to yield/signal\"                       \n[11] \"abrupt lane change\"                            \n[12] \"debris/obstruction on the road\"                \n[13] \"driving in the wrong lane\"                     \n[14] \"failure to signal enter/exit parking\"          \n[15] \"failure to yield right of way\"                 \n[16] \"unfamiliarity with the route/unskilled driving\"\n[17] \"dangerous curve\"                               \n[18] \"medical condition\"                             \n[19] \"sudden stop\"                                   \n[20] \"worn-out/tire blowout\"                         \n[21] \"disabled vehicle without proper signals/signs\" \n[22] \"overloaded vehicle\"                            \n[23] \"reversing vehicle\"                             \n[24] \"straddling lanes\"                              \n[25] \"insufficient light\"                            \n[26] \"vehicle electrical system failure\"             \n[27] \"road in poor condition\"                        \n[28] \"disabled vehicle without proper signals\"       \n[29] \"slippery road\"                                 \n[30] \"obstruction in sight\"                          \n[31] \"using mobile phone while driving\"              \n[32] \"ignoring stop sign while leaving intersection\" \n[33] \"brake/anti-lock brake system failure\"          \n[34] \"no traffic signs\"                              \n[35] \"repair/construction on the road\"               \n[36] \"no presumed cause related to driver\"           \n[37] \"no road divider lines\"                         \n[38] \"inadequate visibility\"                         \n[39] \"using psychoactive substances\"                 \n[40] \"loss of control\"                               \n```\n\n\n:::\n:::\n\n\nCategorize the **presumed_cause** into 3 categories. **Environmental Factor, Driver Behaviour** and **Driver Performance**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_accident <- bmr_accident %>%\n  mutate(factor = case_when(\n    presumed_cause %in% c(\"insufficient light\", \"disabled vehicle without proper signals\", \"no traffic signs\", \"no road divider lines\", \"dangerous curve\", \"worn-out/tire blowout\", \"vehicle electrical system failure\", \"slippery road\", \"repair/construction on the road\", \"inadequate visibility\", \"vehicle equipment failure\", \"debris/obstruction on the road\", \"disabled vehicle without proper signals/signs\", \"straddling lanes\", \"road in poor condition\", \"obstruction in sight\", \"brake/anti-lock brake system failure\", \"no presumed cause related to driver\") ~ \"Environmental\",\n    presumed_cause %in% c(\"speeding\", \"driving under the influence of alcohol\", \"falling asleep\", \"sudden stop\", \"overloaded vehicle\", \"using mobile phone while driving\", \"running red lights/traffic signals\",\"cutting in closely by people/vehicles/animals\", \"illegal overtaking\", \"abrupt lane change\", \"ignoring stop sign while leaving intersection\", \"tailgating\", \"using psychoactive substances\") ~ \"Driver Behaviour\",\n    presumed_cause %in% c(\"failure to yield/signal\", \"driving in the wrong lane\", \"unfamiliarity with the route/unskilled driving\", \"loss of control\", \"failure to signal enter/exit parking\", \"reversing vehicle\", \"failure to yield right of way\", \"medical condition\") ~ \"Driver Performance\",\n    TRUE ~ \"Other\"  # Optional: to handle any cases that don't fit\n  ))\n```\n:::\n\n\nSplit sf dataframe into 3 according to the factor of accident\n\n\n::: {.cell}\n\n```{.r .cell-code}\nef_accident <- bmr_accident %>% \n  filter(factor == \"Environmental\")\ndb_accident <- bmr_accident %>% \n  filter(factor == \"Driver Behaviour\")\ndp_accident <- bmr_accident %>% \n  filter(factor == \"Driver Performance\")\n```\n:::\n\n\nConvert to ppp object\n\n\n::: {.cell}\n\n```{.r .cell-code}\nef_accident_ppp <- as.ppp(ef_accident)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in as.ppp.sf(ef_accident): only first attribute column is used for\nmarks\n```\n\n\n:::\n\n```{.r .cell-code}\ndb_accident_ppp <- as.ppp(db_accident)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in as.ppp.sf(db_accident): only first attribute column is used for\nmarks\n```\n\n\n:::\n\n```{.r .cell-code}\ndp_accident_ppp <- as.ppp(dp_accident)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in as.ppp.sf(dp_accident): only first attribute column is used for\nmarks\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naccidents_factor <- bmr_accident %>%\n  group_by(factor) %>%\n  summarise(Accident_Count = n(), .groups = 'drop') \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(accidents_factor$Accident_Count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  140.0   380.0   708.5  3246.5  3575.0 11429.0 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mar = c(8, 4, 4, 2))\nbarplot(accidents_factor$Accident_Count,\n        names.arg = accidents_factor$factor,\n        ylab = \"No. of Accidents\",\n        las = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-54-1.png){width=672}\n:::\n:::\n\n\nFrom the bar chart plotted above, it can be seen that in Bangkok Metropolitan Region, majority of the accidents are caused due to **driver behaviour.**\n\n#### 4.2.1 Environmental Factor\n\nLet's plot the accident points caused by environmental factor\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(bmr_road) +\n  tm_lines(col=\"grey\") +\n  tm_shape(bmr_accident %>% filter(factor == \"Environmental\")) +\n  tm_dots(alpha=0.5,\n          size=0.05)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-55-1.png){width=672}\n:::\n:::\n\n\n#### 4.2.2 Behavioural Factor - Driver Behaviour\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(bmr_road) +\n  tm_lines(col=\"grey\") +\n  tm_shape(bmr_accident %>% filter(factor == \"Driver Behaviour\")) +\n  tm_dots(alpha=0.5,\n          size=0.05)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-56-1.png){width=672}\n:::\n:::\n\n\nIn accidents caused by **driver behaviour**, we can see the roads that have more concentrated dots are the road lines that most accidents occur due to driver behaviour.\n\n#### 4.2.3 Behavioural Factor - Driver Performance\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(bmr_road) +\n  tm_lines(col=\"grey\") +\n  tm_shape(bmr_accident %>% filter(factor == \"Driver Performance\")) +\n  tm_dots(alpha=0.5,\n          size=0.05)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-57-1.png){width=672}\n:::\n:::\n\n\n### 4.3 Road Accidents by Province\n\n\n::: {.cell}\n\n```{.r .cell-code}\naccidents_province <- bmr_accident %>%\n  group_by(province_en) %>%\n  summarise(Accident_Count = n(), .groups = 'drop') \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(accidents_province$Accident_Count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n    827     922    1469    2164    2162    6089 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mar = c(8, 4, 4, 2))\nbarplot(accidents_province$Accident_Count,\n        names.arg = accidents_province$province_en,\n        ylab = \"No. of Accidents\",\n        las = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-60-1.png){width=672}\n:::\n:::\n\n\nFrom the bar chart above, we can see that the majority of accidents happen in Bangkok area. Let's plot it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbkk <- bmr_accident %>% \n  filter(province_en == \"Bangkok\")\nnb <- bmr_accident %>% \n  filter(province_en == \"Nonthaburi\")\nnp <- bmr_accident %>% \n  filter(province_en == \"Nakhon Pathom\")\npt <- bmr_accident %>% \n  filter(province_en == \"Pathum Thani\")\nsp <- bmr_accident %>% \n  filter(province_en == \"Samut Prakan\")\nss <- bmr_accident %>% \n  filter(province_en == \"Samut Sakhon\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(2,2))\nplot(bkk, main = \"Bangkok\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: plotting the first 9 out of 18 attributes; use max.plot = 18 to plot\nall\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-62-1.png){width=672}\n:::\n:::\n\n\n### 4.4 Bangkok Accidents Analysis\n\nFrom the analysis result above, we can see that Bangkok has the most accident and most of the accidents happen due to driver behaviour. Let us dive deep into Bangkok area for further analysis\n\nFilter out Bangkok and factor using the code chunk below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbkk_accidents <- bmr_accident %>% \n  filter(province_en == \"Bangkok\" & factor == \"Driver Behaviour\")\n```\n:::\n\n\nLet us plot the map below\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(bkk_accidents) +\n  tm_dots()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-64-1.png){width=672}\n:::\n:::\n\n\n![](images/clipboard-988547338.png)\n\nIf we see from the map above, we can see that most of the accidents are concentrated on the 4-way intersection on the right side of the map. These accidents happen due to driver behaviours.\n\nLet us check the type of highway with most accidents using the code below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbkk_highway <- st_join(bmr_road, bkk_accidents)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naccidents_highway <- bkk_highway %>%\n  group_by(bkk_highway$highway) %>%\n  summarise(Highway_Count = n(), .groups = 'drop')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mar = c(8, 4, 4, 2))\nbarplot(accidents_highway$Highway_Count,\n        names.arg = accidents_highway$highway,\n        ylab = \"No. of Accidents\",\n        las = 2)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Unknown or uninitialised column: `highway`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-67-1.png){width=672}\n:::\n:::\n\n\nThe barplot shows that most accidents happen in **primary, secondary and tertiary** highways.\n\n### 4.4 Network Spatial Point Pattern Analysis (NKDE)\n\nUsing the appropriate network spatial point pattern analysis methods, conduct a detailed spatial analysis of the road accidents.\n\n#### 4.4.1 Preparing Lixels Object\n\nThe boundaries data is in geometry points, convert to linestring first\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_lineboundary <- st_cast(bmr_boundary, \"LINESTRING\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_lineboundary <- st_is_valid(bmr_lineboundary)\n```\n:::\n\n\nPrepare Lixels and sample\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_lineboundary <- bmr_boundary %>%\n  mutate(geometry = st_cast(geometry, \"LINESTRING\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlixels <- lixelize_lines(bmr_lineboundary,200,mindist = 50)\nsamples <- lines_center(lixels)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_lineboundary <- bmr_lineboundary[!st_is_valid(bmr_lineboundary),]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(bmr_lineboundary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 477   7\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(bmr_accident)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 12986    19\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(samples)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 477   8\n```\n\n\n:::\n:::\n\n\n#### 4.4.2 Network Kernel Density Estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbmr_lineboundary <- bmr_boundary %>%\n  mutate(geometry = st_cast(geometry, \"LINESTRING\"))\n\ndensities <- nkde(bmr_lineboundary,\n                  events = bmr_accident,\n                  w = rep(1, nrow(bmr_accident)),\n                  samples = samples, \n                  kernel_name = \"quartic\",\n                  method = \"simple\",\n                  bw = 300,\n                  sparse = TRUE,\n                  verbose = FALSE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(bmr_boundary) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in data(bmr_boundary): data set 'bmr_boundary' not found\n```\n\n\n:::\n\n```{.r .cell-code}\ndata(bmr_accident)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in data(bmr_accident): data set 'bmr_accident' not found\n```\n\n\n:::\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntmap mode set to plotting\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(bmr_boundary) + \n  tm_dots(\"grey\") + \n  tm_shape(bmr_accident) + \n  tm_dots(\"red\", size = 0.05)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-75-1.png){width=672}\n:::\n:::\n\n\n## 5 Conclusion\n\nFrom this study, we can conclude that most accidents are caused by driver behaviour and the following picture is the 4 way intersection with the most accident data points.\n\n![](images/clipboard-417656923.png)\n\nMost of the accidents happened in the primary, secondary and tertiary highways. The driver behaviour is something that we need to focus on for future studies, to prevent future accidents from happening. For future safety of road traffic, the Bangkok Metropolitan should pay more attention on primary, secondary and tertiary highways by implementing more strict rules on driving in the road. As we can see from the plotted maps, along the intercity road from Pathum Thani to Samut Prakan are filled with a lot of road accident points.\n",
    "supporting": [
      "Take-home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}